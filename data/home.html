<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Groupie-Tracker</title>
    <link rel="stylesheet" type="text/css" href="data/home.css" />
</head>
<body>
<div class="topHeader">
    <a class="one">Groupie Tracker</a>
    <div class="searchBox">
        <input type="text" class="searchInput" id="myInput" onkeyup="myFunction()" placeholder="Search for names..">
        <img class="iMgn" src="data/Images/Magnifying_glass_icon.png">
        <div  class="suggestion">
            {{ .searchBar }}
        </div>
    </div>
</div>

<div class="maps" >
    <div id="map"></div>
    <button id="close-map-button">x</button>
    <script>
        var map;
        var markers = [];
        function initMap() {
            var options = {
                zoom: 8,
                center: { lat: 42.3601, lng: -71.0589 },
            };
            map = new google.maps.Map(document.getElementById("map"), options);
        }
        function showMarkers(id) {
            // Supprimer tous les anciens marqueurs
            for (var i = 0; i < markers.length; i++) {
                markers[i].setMap(null);
            }
            markers = [];

            // Ajouter de nouveaux marqueurs
            var locationDiv = document.querySelector('[data-id="' + id + '"]');
            var locationPars = locationDiv.getElementsByTagName('p');
            for (var i = 0; i < locationPars.length; i++) {
                var locationText = locationPars[i].textContent;
                var locationSplit = locationText.split(', Date: ');
                var location = locationSplit[0].split(': ')[1].trim();
                var date = locationSplit[1].trim();
                calculateLongLat(location, function(latLng) {
                    if (map instanceof google.maps.Map) { // Vérifier si map est une instance de google.maps.Map
                        var marker = new google.maps.Marker({
                            position: latLng,
                            map: map,
                            title: location,
                        });
                        marker.addListener('click', function() {
                            var infoWindow = new google.maps.InfoWindow({
                                content: date
                            });
                            infoWindow.open(map, marker);
                        });
                        markers.push(marker);
                    }
                });
            }
            showMap();
        }

        function calculateLongLat(location, callback) {
            var geocoder = new google.maps.Geocoder();
            var latLng = { lat: 0, lng: 0 };
            // remplace les tirets par des espaces dans la chaîne de caractères location
            location = location.replace(/-/g, ' ');
            console.log(location)
            geocoder.geocode({ address: location }, function(results, status) {
                if (status == google.maps.GeocoderStatus.OK) {
                    latLng = results[0].geometry.location;
                    callback(latLng);
                }
            });
        }

        function showMap() {
            var mapContainer = document.querySelector("#map");
            mapContainer.style.display = "block";
            var btnContainer = document.querySelector("#close-map-button");
            btnContainer.style.display = "block";
            console.log("work");
        }
    </script>
    <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCpNqnmbKtHzwzdpUN5-koH8ZfDHtZHV5s&callback=initMap"></script>
</div>

<div class="cardFlex">
    {{ .Body }}
</div>

<script src="/data/home.js"></script>

</body>
</html>